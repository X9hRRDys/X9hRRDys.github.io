<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
<channel>
<title><![CDATA[Blog]]></title>
<description><![CDATA[Blog]]></description>
<link>https://X9hRRDys.github.io/</link>
<lastBuildDate>Sat, 27 Jul 2024 22:17:05 +0900</lastBuildDate>
<item>
  <title><![CDATA[ddskk のかな・カナモードで $ を押したときの設定]]></title>
  <description><![CDATA[

<div id="outline-container-orgc1e7bbe" class="outline-2">
<h2 id="orgc1e7bbe">はじめに</h2>
<div class="outline-text-2" id="text-orgc1e7bbe">
<p>
Emacs 上での文字入力には ddskk を利用しています。かな・カナモードで <kbd>$</kbd> を入力するために簡単な設定を行いました。
</p>
</div>
</div>

<div id="outline-container-org5bce138" class="outline-2">
<h2 id="org5bce138">問題</h2>
<div class="outline-text-2" id="text-org5bce138">
<p>
ddskk のかな・カナ入力モード（skk-j-mode）中に <kbd>$</kbd> を入力するとコマンド <code>skk-display-code-for-char-at-point</code> が実行されます。たとえばカーソルが文字「す」の上にあるときに <kbd>$</kbd> を押すとエコーエリアに以下のような文字コードの情報が出力されます（詳細は skk の info にも記載されています）。
</p>
<pre class="example" id="org5554203">
す	KUTEN:04-25, JIS:#x2439, EUC:#xa4b9, SJIS:#x82b7, UNICODE:U+3059, 平仮名す,HIRAGANA LETTER SU
</pre>

<p>
日本語かつ数式を含む LaTeX 文書を作成することが多いので個人的には <kbd>$</kbd> を押したときに次のような振る舞いだと便利です:
</p>
<ol class="org-ol">
<li><kbd>$</kbd> を押した後は数式を入力することがほとんどなので、かな・カナモード (<code>skk-j-mode</code>) から半角英数を入力するモード (<code>skk-latin-mode</code>) に移行する</li>
<li><code>$</code> が入力される</li>
</ol>
</div>
</div>

<div id="outline-container-orgf1a4360" class="outline-2">
<h2 id="orgf1a4360">設定</h2>
<div class="outline-text-2" id="text-orgf1a4360">
<p>
上記の振る舞いを実現するために init.el に次の設定を追記しました。
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #ffffff;">(</span><span style="color: #b6a0ff; font-weight: bold;">with-eval-after-load</span> 'skk
  <span style="color: #ff66ff;">(</span>keymap-set skk-j-mode-map <span style="color: #79a8ff;">"$"</span>
              <span style="color: #00eff0;">(</span><span style="color: #b6a0ff; font-weight: bold;">lambda</span> <span style="color: #ff6b55;">()</span>
                <span style="color: #ff6b55;">(</span><span style="color: #b6a0ff; font-weight: bold;">interactive</span><span style="color: #ff6b55;">)</span>
                <span style="color: #ff6b55;">(</span>skk-latin-mode-on<span style="color: #ff6b55;">)</span>
                <span style="color: #ff6b55;">(</span>self-insert-command 1<span style="color: #ff6b55;">)</span><span style="color: #00eff0;">)</span><span style="color: #ff66ff;">)</span><span style="color: #ffffff;">)</span>
</pre>
</div>
</div>
</div>
<div class="taglist"></div>]]></description>
  <link>https://x9hrrdys.github.io/2024-07-27-dollar-sign-in-ddskk.html</link>
  <guid>https://x9hrrdys.github.io/2024-07-27-dollar-sign-in-ddskk.html</guid>
  <pubDate>Sat, 27 Jul 2024 16:32:00 +0900</pubDate>
</item>
<item>
  <title><![CDATA[Mac に Emacs 29.4 をインストールする]]></title>
  <description><![CDATA[

<div id="outline-container-org3100110" class="outline-2">
<h2 id="org3100110">はじめに</h2>
<div class="outline-text-2" id="text-org3100110">
<p>
MacBook Pro (Apple M2, Sonoma 14.1) に GNU Emacs 29.4 をインストールしました。
</p>
</div>
</div>

<div id="outline-container-org799227a" class="outline-2">
<h2 id="org799227a">準備</h2>
<div class="outline-text-2" id="text-org799227a">
<p>
事前に Homebrew で関連ツールをインストールしました。
</p>
<div class="org-src-container">
<pre class="src src-shell">brew install gcc libgccjit tree-sitter texinfo jansson
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb78d95e" class="outline-2">
<h2 id="orgb78d95e">Emacs のインストール</h2>
<div class="outline-text-2" id="text-orgb78d95e">
<p>
まず GNU Emacs の日本のミラーサイト（<a href="http://ftp.jaist.ac.jp/pub/GNU/emacs/">http://ftp.jaist.ac.jp/pub/GNU/emacs/</a>）から emacs-29.4.tar.gz をダウンロード、展開します。展開したファイルは <code>~/Downloads/</code> にあるとします。
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #f78fe7; font-weight: bold;">cd</span> ~/Downloads/emacs-29.4/
</pre>
</div>
<p>
でソースファイルに移動して
</p>
<div class="org-src-container">
<pre class="src src-shell">./configure --help
</pre>
</div>
<p>
でインストールオプションを確認します。今回は native compilation, tree-sitter, xwidgets 機能を導入します。
</p>

<p>
次の4つのコマンドを実行すると <code>~/Downloads/emacs-29.4/nextstep/</code> に <code>Emacs.app</code> が作成されました。
</p>
<div class="org-src-container">
<pre class="src src-shell">./autogen.sh
./configure --with-xwidgets --with-native-compilation --with-tree-sitter --with-mailutils
make clean
make install
</pre>
</div>

<p>
Emacs.app を <code>~/Applications</code> に移動させます。
</p>
<div class="org-src-container">
<pre class="src src-shell"> mv nextstep/Emacs.app /Applications
</pre>
</div>

<p>
そのまま Emacs を開こうとしても "Emacs.app is damaged and can't be opend." というメッセージが表示されます。次のコマンドを実行するとうまく開けるようになりました。
</p>
<div class="org-src-container">
<pre class="src src-shell">xattr -d com.apple.quarantine /Applications/Emacs.app
</pre>
</div>
</div>
</div>
<div class="taglist"></div>]]></description>
  <link>https://x9hrrdys.github.io/2024-06-26-emacs-29-build.html</link>
  <guid>https://x9hrrdys.github.io/2024-06-26-emacs-29-build.html</guid>
  <pubDate>Wed, 26 Jun 2024 00:00:00 +0900</pubDate>
</item>
<item>
  <title><![CDATA[TeX Live のパッケージの復元]]></title>
  <description><![CDATA[
<p>
TeX Live のパッケージを <code>tlmgr</code> でアップデートすると nicematrix に不具合がありコンパイルがうまくできなくなりました。このパッケージを更新前のものに戻します。
</p>

<div id="outline-container-orgc5ddde8" class="outline-2">
<h2 id="orgc5ddde8">パッケージを復元する</h2>
<div class="outline-text-2" id="text-orgc5ddde8">
<p>
まず nicematrix の情報を確認するためターミナルで次のように入力します。
</p>
<div class="org-src-container">
<pre class="src src-shell">tlmgr info nicematrix
</pre>
</div>
<p>
出力結果の一部に <code>revision: 64433</code> とリビジョン番号が表示されました。 次にコンピュータ上にバックアップされているパッケージのすべてのリビジョンを確認します。 これは <code>tlmgr restore [パッケージ名]</code> で確認できます。今回は
</p>
<div class="org-src-container">
<pre class="src src-shell">tlmgr restore nicematrix
</pre>
</div>
<p>
と入力して
</p>
<div class="org-src-container">
<pre class="src src-shell">Available backups for nicematrix: 64185 <span style="color: #ffffff;">(</span>2022-09-20 07:03<span style="color: #ffffff;">)</span>
</pre>
</div>
<p>
と表示されました。最後に復元を行います。 <code>sudo tlmgr restore [パッケージ名] [リビジョン番号]</code> で指定したリビジョンを復元します。今回の場合は次のように入力します。
</p>
<div class="org-src-container">
<pre class="src src-shell">sudo tlmgr restore nicematrix 64185
</pre>
</div>
<p>
これでコンパイルできました。
</p>
</div>
</div>
<div class="taglist"></div>]]></description>
  <link>https://x9hrrdys.github.io/2022-10-21-texlive-restore-previous-version.html</link>
  <guid>https://x9hrrdys.github.io/2022-10-21-texlive-restore-previous-version.html</guid>
  <pubDate>Wed, 12 Oct 2022 00:00:00 +0900</pubDate>
</item>
<item>
  <title><![CDATA[Emacs バッファ全範囲の一括インデントの改善]]></title>
  <description><![CDATA[
<p>
バッファ全体を一括インデントするとき <kbd>C-x</kbd> <kbd>h</kbd> (mark-whole-buffer) でバッファの全範囲を選択した後 <kbd>TAB</kbd> または <kbd>C-M-\</kbd> で一括インデントできます。しかしながらこの操作はカーソルの位置がバッファの先頭に移動してしまうため、インデントの後にもとの編集位置までもどる手間がかかります。
</p>

<p>
カーソルの位置は維持したまま全範囲を一括インデントするために、 <code>init.el</code> に次のように追記しました。 <kbd>C-x</kbd> <kbd>TAB</kbd> にバインディングしています。
</p>
<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #ffffff;">(</span><span style="color: #b6a0ff; font-weight: bold;">defun</span> <span style="color: #feacd0;">my-indent-whole-buffer</span> <span style="color: #ff66ff;">()</span>
  <span style="color: #9ac8e0; font-style: italic;">"Indent all lines in the buffer."</span>
  <span style="color: #ff66ff;">(</span><span style="color: #b6a0ff; font-weight: bold;">interactive</span><span style="color: #ff66ff;">)</span>
  <span style="color: #ff66ff;">(</span>indent-region <span style="color: #00eff0;">(</span>point-min<span style="color: #00eff0;">)</span> <span style="color: #00eff0;">(</span>point-max<span style="color: #00eff0;">)</span><span style="color: #ff66ff;">)</span><span style="color: #ffffff;">)</span>
<span style="color: #ffffff;">(</span>global-set-key <span style="color: #ff66ff;">(</span>kbd <span style="color: #79a8ff;">"C-x TAB"</span><span style="color: #ff66ff;">)</span> #'my-indent-whole-buffer<span style="color: #ffffff;">)</span>
</pre>
</div>
<div class="taglist"></div>]]></description>
  <link>https://x9hrrdys.github.io/2022-08-21-improve-indent-whole-buffer.html</link>
  <guid>https://x9hrrdys.github.io/2022-08-21-improve-indent-whole-buffer.html</guid>
  <pubDate>Sun, 21 Aug 2022 00:00:00 +0900</pubDate>
</item>
<item>
  <title><![CDATA[Emacs の行頭移動 C-a の改善]]></title>
  <description><![CDATA[
<p>
Emacs で頻繁に使う行頭移動 <kbd>C-a</kbd> を改善しました。
</p>

<p>
Emacs でカーソル位置を行頭に移動させる場合 <kbd>C-a</kbd> と入力します。これは <code>move-beginning-of-line</code> という機能で、インデントに関わらずカーソルは左端まで移動します。しかしながら本当に実現したい操作は「行の空白以外の最初の文字への移動」であることがほとんどでした。今までは <kbd>C-a</kbd> <kbd>TAB</kbd> で行の左端に移動 → 空白以外の最初の文字に移動を実現していました。
</p>

<p>
「行の空白以外の最初の文字への移動」という機能はもともと Emacs に備えられていて <code>back-to-indentation</code> で実現できます。これは <kbd>M-m</kbd> にバインディングされていますが積極的に入力したいと思えません。
</p>

<p>
この操作をどうにかしたくて <kbd>C-a</kbd> の設定を調べていると次のウェブサイトと設定を見つけました。コードを引用します。
</p>

<p>
引用元: <a href="https://d12frosted.io/posts/2020-06-04-beginning-of-line.html">Emacs: moving to beginning of line</a>
</p>
<blockquote>
<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #ffffff;">(</span><span style="color: #b6a0ff; font-weight: bold;">defun</span> <span style="color: #feacd0;">+beginning-of-line</span> <span style="color: #ff66ff;">(</span>arg<span style="color: #ff66ff;">)</span>
  <span style="color: #9ac8e0; font-style: italic;">"Move point back to indentation of beginning of line.</span>

<span style="color: #9ac8e0; font-style: italic;">Move point to the first non-whitespace character on this line. If</span>
<span style="color: #9ac8e0; font-style: italic;">point is already there, move to the beginning of the line.</span>
<span style="color: #9ac8e0; font-style: italic;">Effectively toggle between the first non-whitespace character and</span>
<span style="color: #9ac8e0; font-style: italic;">the beginning of the line.</span>

<span style="color: #9ac8e0; font-style: italic;">If ARG is not nil, move forward ARG lines first. If point reaches</span>
<span style="color: #9ac8e0; font-style: italic;">the beginning or end of the buffer, stop there."</span>
  <span style="color: #ff66ff;">(</span><span style="color: #b6a0ff; font-weight: bold;">interactive</span> <span style="color: #79a8ff;">"P"</span><span style="color: #ff66ff;">)</span>
  <span style="color: #ff66ff;">(</span><span style="color: #b6a0ff; font-weight: bold;">when</span> <span style="color: #00eff0;">(</span>numberp arg<span style="color: #00eff0;">)</span>
    <span style="color: #00eff0;">(</span><span style="color: #b6a0ff; font-weight: bold;">let</span> <span style="color: #ff6b55;">(</span><span style="color: #efef00;">(</span>line-move-visual nil<span style="color: #efef00;">)</span><span style="color: #ff6b55;">)</span>
      <span style="color: #ff6b55;">(</span>forward-line arg<span style="color: #ff6b55;">)</span><span style="color: #00eff0;">)</span><span style="color: #ff66ff;">)</span>

  <span style="color: #ff66ff;">(</span><span style="color: #b6a0ff; font-weight: bold;">let</span> <span style="color: #00eff0;">(</span><span style="color: #ff6b55;">(</span>orig-point <span style="color: #efef00;">(</span>point<span style="color: #efef00;">)</span><span style="color: #ff6b55;">)</span><span style="color: #00eff0;">)</span>
    <span style="color: #00eff0;">(</span>back-to-indentation<span style="color: #00eff0;">)</span>
    <span style="color: #00eff0;">(</span><span style="color: #b6a0ff; font-weight: bold;">when</span> <span style="color: #ff6b55;">(</span>= orig-point <span style="color: #efef00;">(</span>point<span style="color: #efef00;">)</span><span style="color: #ff6b55;">)</span>
      <span style="color: #ff6b55;">(</span>move-beginning-of-line 1<span style="color: #ff6b55;">)</span><span style="color: #00eff0;">)</span><span style="color: #ff66ff;">)</span><span style="color: #ffffff;">)</span>

<span style="color: #ffffff;">(</span>global-set-key <span style="color: #ff66ff;">[</span>remap move-beginning-of-line<span style="color: #ff66ff;">]</span> '+beginning-of-line<span style="color: #ffffff;">)</span>
</pre>
</div>
</blockquote>

<p>
上のコードを <code>init.el</code> に追記すると <kbd>C-a</kbd> は次のようにふるまいます:
</p>

<ol class="org-ol">
<li>基本的には <kbd>C-a</kbd> で「行の空白以外の最初の文字への移動」します。つまり <kbd>M-m</kbd> <code>(back-to-indentation)</code> と同じふるまいをします。</li>
<li>もしもカーソルがはじめから行の空白以外の最初の文字の位置にある場合、 <kbd>C-a</kbd> で行の左端に移動します。つまりもともとの <kbd>C-a</kbd> <code>(move-beginning-of-line)</code> と同じふるまいをします。</li>
<li><kbd>C-a</kbd> を2回か3回押してみるとカーソルが行の左端と、行の空白以外の最初の文字の位置を行ったり来たりします。</li>
<li><kbd>C-u</kbd> <kbd>5</kbd> <kbd>C-a</kbd> と入力すると 5 - 1 = 4 行下の左端にカーソルが移動します。</li>
</ol>

<p>
これは理想的なふるまいです。結局 <code>init.el</code> には次のように追記しました。上の4番目の機能を削除しただけです。
</p>
<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #ffffff;">(</span><span style="color: #b6a0ff; font-weight: bold;">defun</span> <span style="color: #feacd0;">my-move-beginning-of-line</span> <span style="color: #ff66ff;">()</span>
  <span style="color: #9ac8e0; font-style: italic;">"Move point back to indentation of beginning of line.</span>

<span style="color: #9ac8e0; font-style: italic;">Move point to the first non-whitespace character on this line. If</span>
<span style="color: #9ac8e0; font-style: italic;">point is already there, move to the beginning of the line.</span>
<span style="color: #9ac8e0; font-style: italic;">Effectively toggle between the first non-whitespace character and</span>
<span style="color: #9ac8e0; font-style: italic;">the beginning of the line."</span>
  <span style="color: #ff66ff;">(</span><span style="color: #b6a0ff; font-weight: bold;">interactive</span><span style="color: #ff66ff;">)</span>
  <span style="color: #ff66ff;">(</span><span style="color: #b6a0ff; font-weight: bold;">let</span> <span style="color: #00eff0;">(</span><span style="color: #ff6b55;">(</span>orig-point <span style="color: #efef00;">(</span>point<span style="color: #efef00;">)</span><span style="color: #ff6b55;">)</span><span style="color: #00eff0;">)</span>
    <span style="color: #00eff0;">(</span>back-to-indentation<span style="color: #00eff0;">)</span>
    <span style="color: #00eff0;">(</span><span style="color: #b6a0ff; font-weight: bold;">when</span> <span style="color: #ff6b55;">(</span>= orig-point <span style="color: #efef00;">(</span>point<span style="color: #efef00;">)</span><span style="color: #ff6b55;">)</span>
      <span style="color: #ff6b55;">(</span>move-beginning-of-line 1<span style="color: #ff6b55;">)</span><span style="color: #00eff0;">)</span><span style="color: #ff66ff;">)</span><span style="color: #ffffff;">)</span>
<span style="color: #ffffff;">(</span>global-set-key <span style="color: #ff66ff;">(</span>kbd <span style="color: #79a8ff;">"C-a"</span><span style="color: #ff66ff;">)</span> #'my-move-beginning-of-line<span style="color: #ffffff;">)</span>
</pre>
</div>

<p>
小規模な改善ですが頻繁に用いる機能なので重要な改善でした。さまざまなパッケージをインストールして強力な Emacs を作ることも楽しいですが、このような小さな改善を積み重ねるのも楽しいことです。
</p>
<div class="taglist"></div>]]></description>
  <link>https://x9hrrdys.github.io/2022-08-20-improve-move-beginning-of-line.html</link>
  <guid>https://x9hrrdys.github.io/2022-08-20-improve-move-beginning-of-line.html</guid>
  <pubDate>Sat, 20 Aug 2022 00:00:00 +0900</pubDate>
</item>
<item>
  <title><![CDATA[Emacs と Notmuch でメールを管理する]]></title>
  <description><![CDATA[

<div id="outline-container-orgde5ac6e" class="outline-2">
<h2 id="orgde5ac6e">はじめに</h2>
<div class="outline-text-2" id="text-orgde5ac6e">
<p>
Emacs でメールを管理する方法はいくつかありますが、タグベース管理ができる Notmuch を採用しました。以前は Mac 標準の Mail.app を使用していましたがそれと比較して次のメリットがあります。
</p>

<ul class="org-ul">
<li>すべての操作をキーボード経由、かつ簡単な操作で行える。</li>
<li>メールが大量にある場合でも検索が高速で安定している。</li>
<li>タグと柔軟な検索機能のおかげでメールが管理しやすい。</li>
<li>Emacs の他の機能と連携できる。例えば ol-notmuch を用いて org-mode との連携できる。yasnippet でテンプレートを管理できる。</li>
</ul>

<p>
導入までに少し準備が必要ですが、いちど環境を整えてしまえばとても快適です。本題に入るまえにメールの保存形式「Maildir 形式と Mbox 形式」の違いと、メールへのアクセスの形式「POP3 と IMAP」の違いについて簡単にまとめます。
</p>
</div>

<div id="outline-container-org9ecb63f" class="outline-3">
<h3 id="org9ecb63f">Maildir 形式と Mbox 形式について</h3>
<div class="outline-text-3" id="text-org9ecb63f">
<p>
メールの保存形式にはおもに次の2つがあります。
</p>

<ul class="org-ul">
<li>Maildir 形式: 1メッセージごとに1ファイルを作成する形式。</li>
<li>Mbox 形式: すべてのメッセージを1つのファイルにまとめる形式。</li>
</ul>

<p>
Notmuch は Maildir 形式のみに対応しています。Maildir 形式はメッセージがひとつずつ可視化されるので（いざとなれば手動でも）管理がしやすいというメリットもあります。
</p>
</div>
</div>

<div id="outline-container-org3fbb899" class="outline-3">
<h3 id="org3fbb899">POP3 と IMAP について</h3>
<div class="outline-text-3" id="text-org3fbb899">
<p>
メールにアクセスする形式にはおもに次の2つがあります。
</p>
<ul class="org-ul">
<li>POP3: 受信サーバーに届いたメールをパソコンにダウンロードして閲覧する形式。一度ダウンロードされたメールは（基本的には）受信サーバーから削除される。</li>
<li>IMAP: Gmail のようにサーバーに届いたメールをインターネット経由でアクセスしてメールを閲覧する形式。メールの未読、既読、削除などの状態を複数の機器で同期できる。</li>
</ul>

<p>
POP3 は郵便局にあるメールを郵便屋さんが自宅まで届けてくれるイメージです。一度届けられたメールは郵便局に残りません（POP3 も設定すればメールをサーバーに残すことができます）。一方、 IMAP はメールが郵便局に留まりつづけるイメージです。自分が郵便局に行くことでメールの閲覧ができます。本記事では設定が簡単な POP3 形式のメールについて紹介します。
</p>
</div>
</div>
</div>

<div id="outline-container-org2cf6578" class="outline-2">
<h2 id="org2cf6578">使用するソフトフェア</h2>
<div class="outline-text-2" id="text-org2cf6578">
<p>
Mail.app など通常のメールソフトは受信・インデックス作成・閲覧・送信などを一括で行いますが、 Emacs でメール環境を整える場合はそれらの機能を別々にインストール、設定する必要があります。今回使用するものは次の通りです。
</p>

<ul class="org-ul">
<li>getmail6: メールを受信するためのソフト。 <a href="https://getmail6.org">getmail6.org</a></li>
<li>Notmuch: メールのインデックス作成、タグ処理、検索を行う。 Notmuch 自体は Emacs がなくてもターミナル経由で使用できます。 <a href="https://notmuchmail.org">Notmuch &#x2013; Just an email system</a></li>
<li>msmtp: メールの送信を行うためのソフト。 <a href="https://marlam.de/msmtp/msmtp.html">msmtp</a></li>
<li>Emacs の notmuch: Emacs 上で Notmuch の機能を使うためのパッケージ。 Emacs 上でメールの閲覧・タグ処理・検索・作成・送信を行える。 <a href="https://notmuchmail.org/notmuch-emacs/">Notmuch Emacs Interface</a></li>
</ul>
</div>
</div>

<div id="outline-container-org256e9ba" class="outline-2">
<h2 id="org256e9ba">準備: メールの保存場所の作成</h2>
<div class="outline-text-2" id="text-org256e9ba">
<p>
まずは Maildir 形式のメールの保存場所を用意します。
</p>

<ul class="org-ul">
<li><code>~/.maildir/[account1]/</code> を作成します。 <code>[account1]</code> の部分はお好みで。さらにその中にディレクトリ <code>cur, new, tmp</code> を作成します。 Maildir 形式では受信したメールはシステムが処理を行うために一時的に <code>tmp</code> に送られ、既読になるまでは <code>new</code> に、既読となったメールは <code>cur</code> に保存されます。</li>
<li>受信メールと送信メールの保存場所を分離するためにサブディレクトリ <code>sent</code> を作成しました。分離したくない場合、この操作は必要ありません。</li>
<li>下書きメールはアカウントごとに分けずにディレクトリ <code>~/.maildir/drafts</code> 内に保存します。差出人アドレスを指定しないまま保存することが多いためこの方が都合がよいです。</li>
<li><p>
メールアカウントが2つ(<code>[account1], [account2]</code>)ある場合のディレクトリのツリーは次のようになります。 <code>sent</code> と <code>drafts</code> 内にもディレクトリ <code>cur, new, tmp</code> を作成します（システムが自動的に作成してくれる場合もあります）。
</p>
<pre class="example" id="org2e5bf3a">
~/.maildir
├── drafts
│   ├── cur
│   ├── new
│   └── tmp
├── [account1]
│   ├── cur
│   ├── new
│   ├── sent
│   │   ├── cur
│   │   ├── new
│   │   └── tmp
│   └── tmp
└── [account2]
    ├── cur
    ├── new
    ├── sent
    │   ├── cur
    │   ├── new
    │   └── tmp
    └── tmp
</pre></li>
</ul>
</div>
</div>

<div id="outline-container-org440fb18" class="outline-2">
<h2 id="org440fb18">getmail6 でPOP3メールを受信する</h2>
<div class="outline-text-2" id="text-org440fb18">
</div>
<div id="outline-container-org9cb833b" class="outline-3">
<h3 id="org9cb833b">インストール</h3>
<div class="outline-text-3" id="text-org9cb833b">
<p>
getmail6 は POP3、 IMAPメールを受信するためのプログラムです。 Python 3 で動作します<sup><a id="fnr.1" class="footref" href="#fn.1" role="doc-backlink">1</a></sup>。
</p>
<div class="org-src-container">
<pre class="src src-shell">brew install getmail6
</pre>
</div>
<p>
でインストールできます。なお <code>getmail</code> のバージョン 5 までは Python 2 で動作します。こちらは <code>brew install getmail</code> でインストールできます。以下の設定はどちらを使った場合でも共通です。
</p>
</div>
</div>

<div id="outline-container-orgd378301" class="outline-3">
<h3 id="orgd378301">設定</h3>
<div class="outline-text-3" id="text-orgd378301">
<p>
設定ファイルは <code>~.getmail/</code> 内に置きます。 <code>~/.getmail/[account1]</code>, <code>~/.getmail/[account2]</code>,&#x2026; のようにアカウントごとにファイルを作成します。設定の例は次の通りです（参考: <a href="https://getmail6.org/configuration.html#configuring">getmail documentation</a> ）。
</p>
<div class="org-src-container">
<pre class="src src-conf">[<span style="color: #6ae4b9; font-weight: bold;">retriever</span>]
<span style="color: #00d3d0;">type</span> = SimplePOP3SSLRetriever
<span style="color: #00d3d0;">server</span> = [&#21463;&#20449;&#12469;&#12540;&#12496;&#12540;]
<span style="color: #00d3d0;">username</span> = [&#12518;&#12540;&#12470;&#12540;&#21517;]
<span style="color: #00d3d0;">port</span> = 995
<span style="color: #00d3d0;">password</span> = [&#12497;&#12473;&#12527;&#12540;&#12489;]

[<span style="color: #6ae4b9; font-weight: bold;">destination</span>]
<span style="color: #00d3d0;">type</span> = Maildir
<span style="color: #00d3d0;">path</span> = ~/.maildir/[account1]/

[<span style="color: #6ae4b9; font-weight: bold;">options</span>]
<span style="color: #00d3d0;">read_all</span> = false <span style="color: #ff9f80; font-style: italic;"># </span><span style="color: #ff9f80; font-style: italic;">&#19968;&#24230;&#21463;&#20449;&#12375;&#12383;&#12513;&#12540;&#12523;&#12434;&#20877;&#12403;&#21463;&#20449;&#12377;&#12427;&#12371;&#12392;&#12434;&#38450;&#12368;</span>
<span style="color: #00d3d0;">delete_after</span> = 30 <span style="color: #ff9f80; font-style: italic;"># </span><span style="color: #ff9f80; font-style: italic;">&#21463;&#20449;&#12375;&#12390;30&#26085;&#24460;&#12395;&#21066;&#38500;</span>
</pre>
</div>
<p>
パスワードを直書きせず暗号化する方法がありますが、本記事では省略します。
</p>
</div>
</div>

<div id="outline-container-org5bcde2e" class="outline-3">
<h3 id="org5bcde2e">メールの受信</h3>
<div class="outline-text-3" id="text-org5bcde2e">
<p>
ターミナルで
</p>
<div class="org-src-container">
<pre class="src src-shell">getmail -r ~/.getmail/<span style="color: #ffffff;">[</span>account1<span style="color: #ffffff;">]</span> -r ~/.getmail/<span style="color: #ffffff;">[</span>account2<span style="color: #ffffff;">]</span>
</pre>
</div>
<p>
と入力するとメールが受信できます。 <code>crontab</code> コマンドを用いて「15分ごとにメールを自動受信」などの設定もできますが本記事では省略します。
</p>
</div>
</div>
</div>

<div id="outline-container-org7832990" class="outline-2">
<h2 id="org7832990">Notmuch</h2>
<div class="outline-text-2" id="text-org7832990">
</div>
<div id="outline-container-org57fecd9" class="outline-3">
<h3 id="org57fecd9">インストール</h3>
<div class="outline-text-3" id="text-org57fecd9">
<p>
Notmuch は受信したメールのインデックス作成、タグ処理、検索を行うためのプログラムです。メールファイルそのものを書き換えたり移動させたりする機能はありません。
</p>
<div class="org-src-container">
<pre class="src src-shell">brew install notmuch
</pre>
</div>
<p>
でインストールできます。
</p>
</div>
</div>

<div id="outline-container-org4b51fd0" class="outline-3">
<h3 id="org4b51fd0">設定</h3>
<div class="outline-text-3" id="text-org4b51fd0">
<p>
初期設定を行います。ターミナルにはじめて <code>notmuch</code> と入力すると、 <code>~/.notmuch-config</code> が作成されます。対話形式の質問に答えることで設定を行うこともできますが <code>~/.notmuch-config</code> を直接編集することもできます（参考: <a href="https://notmuchmail.org/getting-started/">notmuch: Getting Started with Notmuch</a>）。
</p>
<div class="org-src-container">
<pre class="src src-conf">[<span style="color: #6ae4b9; font-weight: bold;">database</span>]
<span style="color: #00d3d0;">path</span>=/Users/[Mac&#12398;&#12518;&#12540;&#12470;&#12540;&#21517;]/.maildir

[<span style="color: #6ae4b9; font-weight: bold;">user</span>]
<span style="color: #00d3d0;">name</span>=[&#24046;&#20986;&#20154;&#12398;&#21517;&#21069;]
<span style="color: #00d3d0;">primary_email</span>=account1@example.com
<span style="color: #00d3d0;">other_email</span>=account2@example.com

[<span style="color: #6ae4b9; font-weight: bold;">new</span>]
<span style="color: #00d3d0;">tags</span>=unread;inbox; <span style="color: #ff9f80; font-style: italic;"># </span><span style="color: #ff9f80; font-style: italic;">&#26410;&#35501;&#12513;&#12540;&#12523;&#12395;&#33258;&#21205;&#30340;&#12395;&#20184;&#19982;&#12373;&#12428;&#12427;&#12479;&#12464;&#12434;&#25351;&#23450;</span>
<span style="color: #00d3d0;">ignore</span>=

[<span style="color: #6ae4b9; font-weight: bold;">search</span>]
<span style="color: #00d3d0;">exclude_tags</span>=spam; <span style="color: #ff9f80; font-style: italic;"># </span><span style="color: #ff9f80; font-style: italic;">&#12487;&#12501;&#12457;&#12523;&#12488;&#12391;&#26908;&#32034;&#32080;&#26524;&#12363;&#12425;&#38500;&#22806;&#12377;&#12427;&#12479;&#12464;&#12398;&#25351;&#23450;</span>

[<span style="color: #6ae4b9; font-weight: bold;">maildir</span>]
<span style="color: #00d3d0;">synchronize_flags</span>=true
</pre>
</div>

<p>
Notmuch の検索は日本語にも対応していますが設定が必要です。 <code>~/.zshrc</code> に環境変数を加えます（参考: <a href="https://notmuchmail.org/howto/#index10h2">Notmuch: How to&#x2026;</a>）。
</p>
<div class="org-src-container">
<pre class="src src-shell-script"><span style="color: #f78fe7; font-weight: bold;">export</span> <span style="color: #00d3d0;">XAPIAN_CJK_NGRAM</span>=1
</pre>
</div>
<p>
インデックス作成のためにターミナルで
</p>
<div class="org-src-container">
<pre class="src src-shell">notmuch new
</pre>
</div>
<p>
と入力します。メールが大量にある場合は時間がかかります。すでにインデックスを作成したけれども、再度インデックスを作り直したい場合は
</p>
<div class="org-src-container">
<pre class="src src-shell">notmuch reindex <span style="color: #79a8ff;">'*'</span>
</pre>
</div>
<p>
と入力します。
</p>
</div>
</div>

<div id="outline-container-orgf31accf" class="outline-3">
<h3 id="orgf31accf">ターミナル上でメールを検索してみる</h3>
<div class="outline-text-3" id="text-orgf31accf">
<p>
ここまでの設定で Notmuch がうまく機能しているか確かめてみます。ターミナルでメールを検索してみます（参考: <a href="https://notmuchmail.org/doc/latest/man7/notmuch-search-terms.html">notmuch-search-terms</a>）。
</p>
<div class="org-src-container">
<pre class="src src-shell">notmuch search tag:new <span style="color: #ff9f80; font-style: italic;"># </span><span style="color: #ff9f80; font-style: italic;">&#26410;&#35501;&#12513;&#12540;&#12523;&#65288;&#12479;&#12464; new &#12434;&#21547;&#12416;&#12513;&#12540;&#12523;&#65289;&#12434;&#26908;&#32034;</span>
notmuch search date:today <span style="color: #ff9f80; font-style: italic;"># </span><span style="color: #ff9f80; font-style: italic;">&#20170;&#26085;&#21463;&#20449;&#12375;&#12383;&#12513;&#12540;&#12523;&#12434;&#26908;&#32034;</span>
notmuch search from:&#23665; AND date:2020..today <span style="color: #ff9f80; font-style: italic;"># </span><span style="color: #ff9f80; font-style: italic;">&#24046;&#20986;&#21517;&#12395;&#12300;&#23665;&#12301;&#12434;&#21547;&#12416;2020&#24180;&#12363;&#12425;&#20170;&#26085;&#12414;&#12391;&#12398;&#12513;&#12540;&#12523;&#12434;&#26908;&#32034;</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc5df8dd" class="outline-2">
<h2 id="orgc5df8dd">msmtp でメールを送信する</h2>
<div class="outline-text-2" id="text-orgc5df8dd">
</div>
<div id="outline-container-org88257fd" class="outline-3">
<h3 id="org88257fd">インストール</h3>
<div class="outline-text-3" id="text-org88257fd">
<p>
msmtp はメールを送信するためのプログラムです。
</p>
<div class="org-src-container">
<pre class="src src-shell">brew install msmtp
</pre>
</div>
<p>
でインストールできます。
</p>
</div>
</div>

<div id="outline-container-org1502dc1" class="outline-3">
<h3 id="org1502dc1">設定</h3>
<div class="outline-text-3" id="text-org1502dc1">
<p>
設定ファイル <code>~/.msmtprc</code> に複数のアカウントの設定をまとめて記述します（参考: <a href="https://marlam.de/msmtp/msmtp.html#A-user-configuration-file">msmtp: Examples: A user configuration file</a>）。
</p>
<div class="org-src-container">
<pre class="src src-conf"><span style="color: #ff9f80; font-style: italic;"># </span><span style="color: #ff9f80; font-style: italic;">&#12377;&#12409;&#12390;&#12398;&#12450;&#12459;&#12454;&#12531;&#12488;&#12395;&#20849;&#36890;&#12375;&#12383;&#21021;&#26399;&#35373;&#23450;</span>
defaults
auth on
tls on
logfile ~/.msmtp.log

<span style="color: #ff9f80; font-style: italic;"># </span><span style="color: #ff9f80; font-style: italic;">&#20197;&#19979;&#12289;&#12450;&#12459;&#12454;&#12531;&#12488;&#12372;&#12392;&#12398;&#35373;&#23450;</span>
<span style="color: #ff9f80; font-style: italic;"># </span><span style="color: #ff9f80; font-style: italic;">[account1] &#12398;&#35373;&#23450;</span>
account [account1]
host smtp1.example.com
port 587
from account1@example.com
user [&#12518;&#12540;&#12470;&#12540;&#21517;1]
password [&#12497;&#12473;&#12527;&#12540;&#12489;1]

<span style="color: #ff9f80; font-style: italic;"># </span><span style="color: #ff9f80; font-style: italic;">[account2] &#12398;&#35373;&#23450;</span>
account [account2]
host smtp2.example.com
port 465
from account2@example.com
user [&#12518;&#12540;&#12470;&#12540;&#21517;2]
password [&#12497;&#12473;&#12527;&#12540;&#12489;2]
tls_starttls off

account default : [account1]
</pre>
</div>
<p>
ここでもパスワードを直書きせず暗号化する方法がありますが省略します。
</p>
</div>
</div>
</div>

<div id="outline-container-org8755872" class="outline-2">
<h2 id="org8755872">Emacs の notmuch</h2>
<div class="outline-text-2" id="text-org8755872">
<p>
Emacs の notmuch では受信したメールの閲覧、検索、タグ処理、メールの作成と送信ができます。 <kbd>M-x package-install notmuch</kbd> でインストールできます。
</p>

<p>
notmuch には3つのモードが備わっています。
</p>
<ul class="org-ul">
<li>notmuch-hello: <kbd>M-x notmuch</kbd> で notmuch を起動したときに表示される。タグごとのメッセージ件数が表示される。</li>
<li>notmuch-search: 検索したメールの一覧が表示される。メールを選択してタグ処理を行える。</li>
<li>notmuch-show: メール本文が表示される。ここでもタグ処理を行える。</li>
</ul>
</div>

<div id="outline-container-orgb3a74d5" class="outline-3">
<h3 id="orgb3a74d5">作業の流れの例</h3>
<div class="outline-text-3" id="text-orgb3a74d5">
<ul class="org-ul">
<li><kbd>M-x notmuch</kbd> で notmuch-hello バッファが表示される。 <kbd>G</kbd> でインデックスの更新。新しいメールには <code>unread</code> と <code>inbox</code> のタグが自動的につく。</li>
<li><kbd>j</kbd> <kbd>u</kbd> で notmuch-search モードの新しいバッファが開き、未読メッセージ（ <code>unread</code> タグのメッセージ）の一覧が表示される。</li>
<li>メッセージの本文を閲覧する場合は <kbd>RET</kbd> 。 notmuch-show モードで新しいバッファが開きメッセージ本文を閲覧できる。 <code>unread</code> タグは自動的にはずされる。重要ではないメッセージは <kbd>a</kbd> でアーカイブタグをつけて次のメッセージを閲覧する。閲覧を終了する場合は <kbd>q</kbd> 。</li>
<li>メッセージにタグ <code>foo</code> をつける場合は <kbd>+foo</kbd> 、タグを外したい場合は <kbd>-foo</kbd> 。</li>
<li>よく使うタグ処理はキーバインディングを用いることもできる。例えば重要なメールに <code>flagged</code> タグをつける場合は <kbd>k</kbd> <kbd>f</kbd> 。はずす場合は <kbd>k</kbd> <kbd>k</kbd> <kbd>f</kbd> 。</li>
<li><kbd>w</kbd> でメッセージに含まれるすべての添付ファイルを保存。</li>
<li>新規メッセージを作成したい場合は <kbd>m</kbd> 、返信の場合は <kbd>r</kbd> で message-mode のバッファが開く。 <kbd>C-c</kbd> <kbd>C-a</kbd> でファイルの添付。 <kbd>C-c</kbd> <kbd>C-c</kbd> で送信。</li>
<li>作成途中でメッセージを保存する場合は <kbd>C-x</kbd> <kbd>C-s</kbd> 。 <code>draft</code> タグが自動的につく。 <kbd>C-c</kbd> <kbd>C-k</kbd> で作成途中のメッセージのバッファを消去できる。</li>
<li>作成途中のメッセージを再び編集したい場合は <kbd>j</kbd> <kbd>d</kbd> で <code>draft</code> タグの検索結果一覧を表示する。編集したいメッセージ上で <kbd>RET</kbd> 。 notmuch-show モードで書きかけのメッセージが表示されるのでさらに <kbd>e</kbd> を押すと編集できる。</li>
<li>任意の検索を行いたい場合は <kbd>s</kbd> 。検索結果からさらに絞り込みたい場合は検索結果上で <kbd>l</kbd> 。</li>
<li>notmuch-hello、notmuch-search、notmuch-show モードのいずれであっても <kbd>?</kbd> でヘルプ、 <kbd>q</kbd> でバッファを閉じる。</li>
</ul>
</div>
</div>

<div id="outline-container-org4d47a52" class="outline-3">
<h3 id="org4d47a52">init.el の設定</h3>
<div class="outline-text-3" id="text-org4d47a52">
<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">&#26085;&#26412;&#35486;&#26908;&#32034;&#12398;&#12383;&#12417;&#12398;&#29872;&#22659;&#22793;&#25968;&#12398;&#35373;&#23450;</span>
<span style="color: #ffffff;">(</span>setenv <span style="color: #79a8ff;">"XAPIAN_CJK_NGRAM"</span> <span style="color: #79a8ff;">"1"</span><span style="color: #ffffff;">)</span>

<span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">message &#12487;&#12451;&#12524;&#12463;&#12488;&#12522;&#12398;&#35373;&#23450;</span>
<span style="color: #ffffff;">(</span><span style="color: #b6a0ff; font-weight: bold;">setq</span> message-directory <span style="color: #79a8ff;">"~/.maildir"</span><span style="color: #ffffff;">)</span>

<span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">&#12513;&#12540;&#12523;&#12504;&#12483;&#12480;&#12289;&#12456;&#12531;&#12505;&#12525;&#12540;&#12503;&#12398;&#35373;&#23450;</span>
<span style="color: #ffffff;">(</span><span style="color: #b6a0ff; font-weight: bold;">setq</span> message-sendmail-f-is-evil t
      message-sendmail-extra-arguments '<span style="color: #ff66ff;">(</span><span style="color: #79a8ff;">"--read-envelope-from"</span><span style="color: #ff66ff;">)</span>
      mail-specify-envelope-from t
      mail-envelope-from 'header
      message-sendmail-envelope-from 'header<span style="color: #ffffff;">)</span>

<span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">&#12513;&#12483;&#12475;&#12540;&#12472;&#20316;&#25104;&#26178;&#12395; CC: &#35352;&#20837;&#27396;&#12434;&#21152;&#12360;&#12427;</span>
<span style="color: #ffffff;">(</span><span style="color: #b6a0ff; font-weight: bold;">setq</span> message-default-mail-headers <span style="color: #79a8ff;">"Cc: \n"</span><span style="color: #ffffff;">)</span>
<span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">CC&#12392;BCC &#12434;&#21152;&#12360;&#12383;&#12356;&#22580;&#21512;&#12399;</span>
<span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">(setq message-default-mail-headers "Cc: \nBcc: \n")</span>

<span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">&#12513;&#12483;&#12475;&#12540;&#12472;&#12496;&#12483;&#12501;&#12449;&#12391; auto-fill &#12373;&#12428;&#12427;&#25991;&#23383;&#25968;&#12398;&#35373;&#23450;</span>
<span style="color: #ffffff;">(</span><span style="color: #b6a0ff; font-weight: bold;">setq</span> message-fill-column 100<span style="color: #ffffff;">)</span>

<span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">&#36865;&#20449;&#24460;&#12395;&#12496;&#12483;&#12501;&#12449;&#12434;&#38281;&#12376;&#12427;</span>
<span style="color: #ffffff;">(</span><span style="color: #b6a0ff; font-weight: bold;">setq</span> message-kill-buffer-on-exit t<span style="color: #ffffff;">)</span>

<span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">&#28155;&#20184;&#12501;&#12449;&#12452;&#12523;&#12398;&#20445;&#23384;&#20808;&#12398;&#21021;&#26399;&#35373;&#23450;</span>
<span style="color: #ffffff;">(</span><span style="color: #b6a0ff; font-weight: bold;">setq</span> mm-default-directory <span style="color: #79a8ff;">"~/Downloads/"</span><span style="color: #ffffff;">)</span>

<span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">sendmail&#12289;&#36865;&#20449;&#12398;&#35373;&#23450;</span>
<span style="color: #ffffff;">(</span><span style="color: #b6a0ff; font-weight: bold;">setq</span> send-mail-function 'sendmail-send-it
      sendmail-program <span style="color: #79a8ff;">"/usr/local/bin/msmtp"</span><span style="color: #ffffff;">)</span>

<span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">&#36865;&#20449;&#20803;&#12398;&#12467;&#12531;&#12500;&#12517;&#12540;&#12479;&#21517;&#12398;&#35373;&#23450;</span>
<span style="color: #ffffff;">(</span><span style="color: #b6a0ff; font-weight: bold;">setq</span> mail-host-address <span style="color: #79a8ff;">"example.com"</span><span style="color: #ffffff;">)</span>

<span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">notmuch &#12398;&#35373;&#23450;</span>
<span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">UI</span>
<span style="color: #ffffff;">(</span><span style="color: #b6a0ff; font-weight: bold;">setq</span> notmuch-hello-sections
      <span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">notmuch-hello &#12514;&#12540;&#12489;&#12391;&#26908;&#32034;&#12508;&#12483;&#12463;&#12473;&#12392;&#12501;&#12483;&#12479;&#12434;&#38750;&#34920;&#31034;&#12395;&#12377;&#12427;</span>
      <span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">&#34920;&#31034;&#12373;&#12379;&#12383;&#12356;&#22580;&#21512;&#12399;&#12467;&#12513;&#12531;&#12488;&#12450;&#12454;&#12488;&#12434;&#12399;&#12378;&#12377;</span>
      <span style="color: #ff66ff;">(</span>list #'notmuch-hello-insert-header
            #'notmuch-hello-insert-saved-searches
            <span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">#'notmuch-hello-insert-search</span>
            <span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">#'notmuch-hello-insert-recent-searches</span>
            #'notmuch-hello-insert-alltags
            <span style="color: #ff9f80; font-style: italic;">;;</span><span style="color: #ff9f80; font-style: italic;">#'notmuch-hello-insert-footer</span>
            <span style="color: #ff66ff;">)</span><span style="color: #ffffff;">)</span>

<span style="color: #ffffff;">(</span><span style="color: #b6a0ff; font-weight: bold;">setq</span> notmuch-show-logo nil
      <span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">&#12513;&#12540;&#12523;&#12398;&#20214;&#25968;&#12434; "1 000" &#12391;&#12399;&#12394;&#12367; "1000" &#12392;&#34920;&#31034;&#12373;&#12379;&#12427;</span>
      notmuch-hello-thousands-separator <span style="color: #79a8ff;">""</span>
      <span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">0&#20214;&#12398;&#12479;&#12464;&#12418;&#34920;&#31034;&#12373;&#12379;&#12427;</span>
      notmuch-show-empty-saved-searches t
      <span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">&#26032;&#12375;&#12356;&#12513;&#12540;&#12523;&#12434;&#19978;&#12395;&#34920;&#31034;</span>
      notmuch-search-oldest-first nil<span style="color: #ffffff;">)</span>

<span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">&#12479;&#12464;&#12395;&#38306;&#12431;&#12427;&#35373;&#23450;</span>

<span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">&#12450;&#12540;&#12459;&#12452;&#12502;&#12377;&#12427;&#12513;&#12540;&#12523;&#12398;&#12479;&#12464;&#20966;&#29702;&#12398;&#35373;&#23450;</span>
<span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">inbox &#12479;&#12464;&#12364;&#12399;&#12378;&#12373;&#12428;&#12289; archived &#12479;&#12464;&#12434;&#12388;&#12369;&#12427;</span>
<span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">&#35373;&#23450;&#12375;&#12394;&#12356;&#12392; inbox &#12479;&#12464;&#12399;&#12399;&#12378;&#12428;&#12427;&#12364; archived &#12479;&#12464;&#12399;&#12388;&#12363;&#12394;&#12356;</span>
<span style="color: #ffffff;">(</span><span style="color: #b6a0ff; font-weight: bold;">setq</span> notmuch-archive-tags '<span style="color: #ff66ff;">(</span><span style="color: #79a8ff;">"-inbox"</span> <span style="color: #79a8ff;">"+archived"</span><span style="color: #ff66ff;">)</span><span style="color: #ffffff;">)</span>

<span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">notmuch-archive-tags &#12392;&#21516;&#27096;&#12398;&#35373;&#23450;&#12434;</span>
<span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">&#26082;&#35501;&#12289;&#36820;&#20449;&#12289;&#36578;&#36865;&#12513;&#12540;&#12523;&#12395;&#23550;&#12375;&#12390;&#34892;&#12358;</span>
<span style="color: #ffffff;">(</span><span style="color: #b6a0ff; font-weight: bold;">setq</span> notmuch-show-mark-read-tags '<span style="color: #ff66ff;">(</span><span style="color: #79a8ff;">"-unread"</span><span style="color: #ff66ff;">)</span><span style="color: #ffffff;">)</span>
<span style="color: #ffffff;">(</span><span style="color: #b6a0ff; font-weight: bold;">setq</span> notmuch-message-replied-tags '<span style="color: #ff66ff;">(</span><span style="color: #79a8ff;">"+replied"</span><span style="color: #ff66ff;">)</span><span style="color: #ffffff;">)</span>
<span style="color: #ffffff;">(</span><span style="color: #b6a0ff; font-weight: bold;">setq</span> notmuch-message-forwarded-tags '<span style="color: #ff66ff;">(</span><span style="color: #79a8ff;">"+forwarded"</span><span style="color: #ff66ff;">)</span><span style="color: #ffffff;">)</span>

<span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">draft&#12501;&#12457;&#12523;&#12480;&#12398;&#35373;&#23450;</span>
<span style="color: #ffffff;">(</span><span style="color: #b6a0ff; font-weight: bold;">setq</span> notmuch-draft-folder <span style="color: #79a8ff;">"drafts"</span><span style="color: #ffffff;">)</span>

<span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">&#20316;&#25104;&#36884;&#20013;&#12395;&#20445;&#23384;&#12375;&#12383;&#12513;&#12540;&#12523;&#12395; draft &#12479;&#12464;&#12434;&#12388;&#12369;</span>
<span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">inbox&#12289;unread &#12479;&#12464;&#12399;&#12399;&#12378;&#12377;</span>
<span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">&#35373;&#23450;&#12375;&#12394;&#12356;&#12392; inbox&#12289;unread &#12479;&#12464;&#12418;&#12388;&#12367;</span>
<span style="color: #ffffff;">(</span><span style="color: #b6a0ff; font-weight: bold;">setq</span> notmuch-draft-tags '<span style="color: #ff66ff;">(</span><span style="color: #79a8ff;">"+draft"</span> <span style="color: #79a8ff;">"-inbox"</span> <span style="color: #79a8ff;">"-unread"</span><span style="color: #ff66ff;">)</span><span style="color: #ffffff;">)</span>

<span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">&#12479;&#12464;&#20966;&#29702;&#12398;&#12461;&#12540;&#12496;&#12452;&#12531;&#12487;&#12451;&#12531;&#12464;</span>
<span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">&#20363;&#12360;&#12400; notmuch-search &#12514;&#12540;&#12489;&#12420; notmuch-show &#12514;&#12540;&#12489;&#12391;</span>
<span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">k d &#12392;&#20837;&#21147;&#12377;&#12427;&#12392; deleted &#12479;&#12464;&#12364;&#36861;&#21152;&#12373;&#12428;&#12289;inbox&#12289;archived &#12479;&#12464;&#12364;&#12399;&#12378;&#12373;&#12428;&#12427;</span>
<span style="color: #ffffff;">(</span><span style="color: #b6a0ff; font-weight: bold;">setq</span> notmuch-tagging-keys
      `<span style="color: #ff66ff;">(</span><span style="color: #00eff0;">(</span>,<span style="color: #ff6b55;">(</span>kbd <span style="color: #79a8ff;">"a"</span><span style="color: #ff6b55;">)</span> notmuch-archive-tags <span style="color: #79a8ff;">"Archive"</span><span style="color: #00eff0;">)</span>
        <span style="color: #00eff0;">(</span>,<span style="color: #ff6b55;">(</span>kbd <span style="color: #79a8ff;">"d"</span><span style="color: #ff6b55;">)</span> <span style="color: #ff6b55;">(</span><span style="color: #79a8ff;">"+deleted"</span> <span style="color: #79a8ff;">"-inbox"</span> <span style="color: #79a8ff;">"-archived"</span><span style="color: #ff6b55;">)</span> <span style="color: #79a8ff;">"Delete"</span><span style="color: #00eff0;">)</span>
        <span style="color: #00eff0;">(</span>,<span style="color: #ff6b55;">(</span>kbd <span style="color: #79a8ff;">"f"</span><span style="color: #ff6b55;">)</span> <span style="color: #ff6b55;">(</span><span style="color: #79a8ff;">"+flagged"</span><span style="color: #ff6b55;">)</span> <span style="color: #79a8ff;">"Flag"</span><span style="color: #00eff0;">)</span>
        <span style="color: #00eff0;">(</span>,<span style="color: #ff6b55;">(</span>kbd <span style="color: #79a8ff;">"u"</span><span style="color: #ff6b55;">)</span> notmuch-show-mark-read-tags <span style="color: #79a8ff;">"Mark read"</span><span style="color: #00eff0;">)</span><span style="color: #ff66ff;">)</span><span style="color: #ffffff;">)</span>

<span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">&#12513;&#12483;&#12475;&#12540;&#12472;&#26908;&#32034;&#12398;&#12461;&#12540;&#12496;&#12452;&#12531;&#12487;&#12451;&#12531;&#12464;</span>
<span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">&#20363;&#12360;&#12400; notmuch-hello&#12289;notmuch-search&#12289;notmuch-show &#12514;&#12540;&#12489;&#12391;</span>
<span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">j A &#12392;&#20837;&#21147;&#12377;&#12427;&#12392;&#12377;&#12409;&#12390;&#12398;&#12513;&#12540;&#12523;&#12364;&#34920;&#31034;&#12373;&#12428;&#12289;</span>
<span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">j i &#12392;&#20837;&#21147;&#12377;&#12427;&#12392; inbox &#12479;&#12464;&#12364;&#12388;&#12356;&#12383;&#12513;&#12540;&#12523;&#12364;&#34920;&#31034;&#12373;&#12428;&#12427;</span>
<span style="color: #ffffff;">(</span><span style="color: #b6a0ff; font-weight: bold;">setq</span> notmuch-saved-searches
      `<span style="color: #ff66ff;">(</span><span style="color: #00eff0;">(</span><span style="color: #f78fe7; font-weight: bold;">:name</span> <span style="color: #79a8ff;">"all"</span> <span style="color: #f78fe7; font-weight: bold;">:query</span> <span style="color: #79a8ff;">"*"</span> <span style="color: #f78fe7; font-weight: bold;">:key</span> ,<span style="color: #ff6b55;">(</span>kbd <span style="color: #79a8ff;">"A"</span><span style="color: #ff6b55;">)</span><span style="color: #00eff0;">)</span>
        <span style="color: #00eff0;">(</span><span style="color: #f78fe7; font-weight: bold;">:name</span> <span style="color: #79a8ff;">"archived"</span> <span style="color: #f78fe7; font-weight: bold;">:query</span> <span style="color: #79a8ff;">"tag:archived"</span> <span style="color: #f78fe7; font-weight: bold;">:key</span> ,<span style="color: #ff6b55;">(</span>kbd <span style="color: #79a8ff;">"a"</span><span style="color: #ff6b55;">)</span><span style="color: #00eff0;">)</span>
        <span style="color: #00eff0;">(</span><span style="color: #f78fe7; font-weight: bold;">:name</span> <span style="color: #79a8ff;">"deleted"</span> <span style="color: #f78fe7; font-weight: bold;">:query</span> <span style="color: #79a8ff;">"tag:deleted"</span> <span style="color: #f78fe7; font-weight: bold;">:key</span> ,<span style="color: #ff6b55;">(</span>kbd <span style="color: #79a8ff;">"D"</span><span style="color: #ff6b55;">)</span><span style="color: #00eff0;">)</span>
        <span style="color: #00eff0;">(</span><span style="color: #f78fe7; font-weight: bold;">:name</span> <span style="color: #79a8ff;">"drafts"</span> <span style="color: #f78fe7; font-weight: bold;">:query</span> <span style="color: #79a8ff;">"tag:draft"</span> <span style="color: #f78fe7; font-weight: bold;">:key</span> ,<span style="color: #ff6b55;">(</span>kbd <span style="color: #79a8ff;">"d"</span><span style="color: #ff6b55;">)</span><span style="color: #00eff0;">)</span>
        <span style="color: #00eff0;">(</span><span style="color: #f78fe7; font-weight: bold;">:name</span> <span style="color: #79a8ff;">"flagged"</span> <span style="color: #f78fe7; font-weight: bold;">:query</span> <span style="color: #79a8ff;">"tag:flagged"</span> <span style="color: #f78fe7; font-weight: bold;">:key</span> ,<span style="color: #ff6b55;">(</span>kbd <span style="color: #79a8ff;">"f"</span><span style="color: #ff6b55;">)</span><span style="color: #00eff0;">)</span>
        <span style="color: #00eff0;">(</span><span style="color: #f78fe7; font-weight: bold;">:name</span> <span style="color: #79a8ff;">"inbox"</span> <span style="color: #f78fe7; font-weight: bold;">:query</span> <span style="color: #79a8ff;">"tag:inbox"</span> <span style="color: #f78fe7; font-weight: bold;">:key</span> ,<span style="color: #ff6b55;">(</span>kbd <span style="color: #79a8ff;">"i"</span><span style="color: #ff6b55;">)</span><span style="color: #00eff0;">)</span>
        <span style="color: #00eff0;">(</span><span style="color: #f78fe7; font-weight: bold;">:name</span> <span style="color: #79a8ff;">"replied"</span> <span style="color: #f78fe7; font-weight: bold;">:query</span> <span style="color: #79a8ff;">"tag:replied"</span> <span style="color: #f78fe7; font-weight: bold;">:key</span> ,<span style="color: #ff6b55;">(</span>kbd <span style="color: #79a8ff;">"R"</span><span style="color: #ff6b55;">)</span><span style="color: #00eff0;">)</span>
        <span style="color: #00eff0;">(</span><span style="color: #f78fe7; font-weight: bold;">:name</span> <span style="color: #79a8ff;">"sent"</span> <span style="color: #f78fe7; font-weight: bold;">:query</span> <span style="color: #79a8ff;">"tag:sent"</span> <span style="color: #f78fe7; font-weight: bold;">:key</span> ,<span style="color: #ff6b55;">(</span>kbd <span style="color: #79a8ff;">"s"</span><span style="color: #ff6b55;">)</span><span style="color: #00eff0;">)</span>
        <span style="color: #00eff0;">(</span><span style="color: #f78fe7; font-weight: bold;">:name</span> <span style="color: #79a8ff;">"unread"</span> <span style="color: #f78fe7; font-weight: bold;">:query</span> <span style="color: #79a8ff;">"tag:inbox AND tag:unread"</span> <span style="color: #f78fe7; font-weight: bold;">:key</span> ,<span style="color: #ff6b55;">(</span>kbd <span style="color: #79a8ff;">"u"</span><span style="color: #ff6b55;">)</span><span style="color: #00eff0;">)</span><span style="color: #ff66ff;">)</span><span style="color: #ffffff;">)</span>

<span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">notmuch-search &#12514;&#12540;&#12489;&#12391;</span>
<span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">&#29305;&#23450;&#12398;&#12479;&#12464;&#12364;&#12388;&#12356;&#12383;&#12513;&#12483;&#12475;&#12540;&#12472;&#12398;&#33394;&#12392;&#25991;&#23383;&#12398;&#22826;&#12373;&#12434;&#22793;&#12360;&#12427;</span>
<span style="color: #ffffff;">(</span><span style="color: #b6a0ff; font-weight: bold;">setq</span> notmuch-search-line-faces
      '<span style="color: #ff66ff;">(</span><span style="color: #00eff0;">(</span><span style="color: #79a8ff;">"unread"</span> . <span style="color: #ff6b55;">(</span><span style="color: #f78fe7; font-weight: bold;">:weight</span> bold<span style="color: #ff6b55;">)</span><span style="color: #00eff0;">)</span>
        <span style="color: #00eff0;">(</span><span style="color: #79a8ff;">"flagged"</span> . <span style="color: #ff6b55;">(</span><span style="color: #f78fe7; font-weight: bold;">:foreground</span> <span style="color: #79a8ff;">"#E27E8D"</span><span style="color: #ff6b55;">)</span><span style="color: #00eff0;">)</span>
        <span style="color: #00eff0;">(</span><span style="color: #79a8ff;">"deleted"</span> . <span style="color: #ff6b55;">(</span><span style="color: #f78fe7; font-weight: bold;">:foreground</span> <span style="color: #79a8ff;">"#A7ADBA"</span><span style="color: #ff6b55;">)</span><span style="color: #00eff0;">)</span><span style="color: #ff66ff;">)</span><span style="color: #ffffff;">)</span>

<span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">&#36865;&#20449;&#12375;&#12383;&#12513;&#12540;&#12523;&#12398;&#20445;&#23384;&#22580;&#25152;&#12392;&#12289;&#36865;&#20449;&#12375;&#12383;&#12513;&#12540;&#12523;&#12398;&#12479;&#12464;&#20966;&#29702;&#12398;&#35373;&#23450;</span>
<span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">&#36865;&#20449;&#24460;&#12395; sent &#12479;&#12464;&#12434;&#12388;&#12369; unread&#12289;inbox &#12479;&#12464;&#12434;&#12399;&#12378;&#12377;</span>
<span style="color: #ff9f80; font-style: italic;">;; </span><span style="color: #ff9f80; font-style: italic;">&#35373;&#23450;&#12375;&#12394;&#12356;&#12392; unread&#12289;inbox &#12479;&#12464;&#12418;&#12388;&#12367;</span>
<span style="color: #ffffff;">(</span><span style="color: #b6a0ff; font-weight: bold;">setq</span> notmuch-fcc-dirs
      '<span style="color: #ff66ff;">(</span><span style="color: #00eff0;">(</span><span style="color: #79a8ff;">"account1@example.com"</span> . <span style="color: #79a8ff;">"[account1]/sent +sent -unread -inbox"</span><span style="color: #00eff0;">)</span>
        <span style="color: #00eff0;">(</span><span style="color: #79a8ff;">"account2@example.com"</span> . <span style="color: #79a8ff;">"[account2]/sent +sent -unread -inbox"</span><span style="color: #00eff0;">)</span><span style="color: #ff66ff;">)</span><span style="color: #ffffff;">)</span>
</pre>
</div>

<ul class="org-ul">
<li>quote <code>'</code> と backquote <code>`</code> が混在しています。</li>
<li>環境変数の設定 <code>(setenv "XAPIAN_CJK_NGRAM" "1")</code> を行わないと日本語検索がうまくいきません。重要な設定です。</li>
<li><code>(setq message-sendmail-f-is-evil t)</code> を設定しないとメールヘッダに送信元のコンピュータのユーザー名が含まれてしまいます。</li>
<li><code>(setq mail-host-address "example.com")</code> は何か設定しないとメールヘッダのメッセージIDに <code>xxx@[コンピューター名].local.mail-host-address-is-not-set</code> のような形で自分のコンピューター名が含まれてしまいます。 <code>"example.com"</code> はお好みで。</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgbfb8912" class="outline-2">
<h2 id="orgbfb8912">不要なメールファイルをゴミ箱に移動させる</h2>
<div class="outline-text-2" id="text-orgbfb8912">
<p>
Notmuch にはファイルを書き換えたり移動させたりする機能はありません。したがってメールファイルを直接削除することもできません。メールをゴミ箱に移動させるためには削除したいメールに <code>deleted</code> タグをつけます。その後ターミナルで次のように入力してファイルをゴミ箱に移動させます（参考: <a href="https://notmuchmail.org/excluding/">Notmuch: Message exclusion and deletion</a>）。
</p>
<div class="org-src-container">
<pre class="src src-shell">notmuch search --output=files --format=text0 tag:deleted | xargs -0 -I% mv % ~/.Trash/
</pre>
</div>
</div>
</div>

<div id="outline-container-org5a41ef7" class="outline-2">
<h2 id="org5a41ef7">おまけ1: User-Agent の設定</h2>
<div class="outline-text-2" id="text-org5a41ef7">
<p>
メールのソースにはヘッダとして差出人(From)や宛先(To)の情報が記載されています。Emacs notmuch でソースを確認する場合は <code>notmuch-show</code> モードで <kbd>V</kbd> を押します。このメールヘッダには差出人が用いたメールソフトの情報が <code>User-Agent</code> や <code>X-Mailer</code> として記載されていることもあります。Notmuch と Emacs を使っていますよ、という情報をメールヘッダに
</p>
<pre class="example">
User-Agent: Notmuch 0.36, Emacs 28.1
</pre>
<p>
という形で記載したい場合は <code>init.el</code> に次の設定を加えます。
</p>
<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #ffffff;">(</span><span style="color: #b6a0ff; font-weight: bold;">setq</span> notmuch-mua-user-agent-function
      <span style="color: #ff66ff;">(</span><span style="color: #b6a0ff; font-weight: bold;">lambda</span> <span style="color: #00eff0;">()</span>
        <span style="color: #00eff0;">(</span>concat <span style="color: #79a8ff;">"Notmuch "</span> <span style="color: #ff6b55;">(</span>notmuch-cli-version<span style="color: #ff6b55;">)</span> <span style="color: #79a8ff;">", Emacs "</span> emacs-version<span style="color: #00eff0;">)</span><span style="color: #ff66ff;">)</span><span style="color: #ffffff;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5286581" class="outline-2">
<h2 id="org5286581">おまけ2: org-mode のファイルにリンクをはる</h2>
<div class="outline-text-2" id="text-org5286581">
<p>
ol-notmuch を用いると「メッセージ」、あるいは「検索結果」へのリンクを org-mode にはることができます。  <code>package-install ol-notmuch</code> でインストールできます。 <code>init.el</code> への設定は特にありません。メッセージ（notmuch-show モード）または検索結果（notmuch-search モード）上で <kbd>C-c</kbd> <kbd>l</kbd> を押すとリンクが生成されます。 org-mode で <kbd>C-c</kbd> <kbd>C-l</kbd> を押すとリンクをはることができます。
</p>
</div>
</div>

<div id="outline-container-org51e9780" class="outline-2">
<h2 id="org51e9780">おわりに</h2>
<div class="outline-text-2" id="text-org51e9780">
<p>
Mail.app から Emacs notmuch への移行のデメリットは添付ファイルをクイックルックで確認できないことです。人によっては html 形式のメールがテキスト形式で表示されることも気になるかもしれませんが、個人的には問題ありません。「はじめに」で述べた Emacs notmuch のメリットも合わせて考えると、総合的にはこのメール環境に満足しています。
</p>

<p>
なにより使い慣れた Emacs にふれる時間が増えて楽しいことがいちばんのメリットかもしれません。
</p>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1" role="doc-backlink">1</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<span class="timestamp-wrapper"><span class="timestamp">[2023-08-24 Thu] </span></span> はじめの記事では getmail6 を pip でインストールする方法を紹介していましたが Homebrew でインストールできるようになったので修正。
</p></div></div>


</div>
</div><div class="taglist"></div>]]></description>
  <link>https://x9hrrdys.github.io/2022-07-21-emacs-notmuch-mail.html</link>
  <guid>https://x9hrrdys.github.io/2022-07-21-emacs-notmuch-mail.html</guid>
  <pubDate>Thu, 21 Jul 2022 00:00:00 +0900</pubDate>
</item>
</channel>
</rss>
